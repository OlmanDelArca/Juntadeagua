

<?php
session_start();
if (!isset($_SESSION['nombre_usuario'])) {
    header("Location: index.php");
    exit();
}
?>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administrador</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Panel de Administrador</h1>
        <button onclick="location.href='buscar_abonado.html'">Buscar Abonado</button>
        <button onclick="location.href='agregar_abonado.html'">Registrar Abonado</button>
        <button onclick="location.href='pagar_factura.html'">Pagar Factura</button>
        <button onclick="location.href='reconexion_servicio.html'">Pagar Reconexión de Servicio</button>
        <button onclick="location.href='logout.php'">Cerrar Sesión</button>
    </div>
</body>
</html>



<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Agregar Usuario</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="user-container">
        <h2>Agregar Usuario</h2>
        <form id="userForm" action="agregar_usuario.php" method="POST">
            <input type="nombre_usuario" name="nombre_usuario" placeholder="Nombre de Usuario" required>
            <input type="sector" name="sector" placeholder="sector" required>
            <input type="telefono" name="telefono" placeholder="telefonoa" required>
            <input type="email" name="email" placeholder="email" required>
            <input type="lote" name="lote" placeholder="lote" required>
            <button type="submit">Agregar</button>
        </form>
    </div>
</body>
</html>

<?php
include 'conexion.php';

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $nombre_usuario = $_POST['nombre_usuario'];
    $contrasena = password_hash($_POST['contrasena'], PASSWORD_DEFAULT);

    $sql = "INSERT INTO usuarios (nombre_usuario, sector, telefono, email, lote) VALUES ('$nombre_usuario','$sector','$telefono', '$email', '$lote')";

    if ($conn->query($sql) === TRUE) {
        echo "Usuario agregado exitosamente.";
    } else {
        echo "Error al agregar el usuario: " . $conn->error;
    }
}
?>



<?php
$servername = "localhost";
$username = "root";
$password = "superadmin";
$dbname = "sistema_facturacion";

$conn = new mysqli($localhost, $root, $superadmin, $sistema_facturacion);

if ($conn->connect_error) {
    die("Conexión fallida: " . $conn->connect_error);
}
?>



[
    {

        "nombre": "Juan Pérez",
        "sector": "Sector 1",
        "telefono": "123456789",
        "correo": "juanperez@example.com",
        "numero_lote": "A1",

    },
    {

        "nombre": "Ana López",
        "sector": "Sector 2",
        "telefono": "987654321",
        "correo": "analopez@example.com",
        "numero_lote": "B2",

    }
    // Agrega más usuarios aquí
]




*{
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    text-decoration: none;
    font-family: 'Roboto', sans-serif;
}

body{
    background-image: url(../images/bg4.jpg);
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    background-attachment: fixed;
}

main{
    width: 100%;
    padding: 20px;
    margin: auto;
    margin-top: 100px;
}

.contenedor__todo{
    width: 100%;
    max-width: 800px;
    margin: auto;
    position: relative;
}

.caja__trasera{
    width: 100%;
    padding: 10px 20px;
    display: flex;
    justify-content: center;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    background-color: rgba(0, 128, 255, 0.5);

}

.caja__trasera div{
    margin: 100px 40px;
    color: white;
    transition: all 500ms;
}


.caja__trasera div p,
.caja__trasera button{
    margin-top: 30px;
}

.caja__trasera div h3{
    font-weight: 400;
    font-size: 26px;
}

.caja__trasera div p{
    font-size: 16px;
    font-weight: 300;
}

.caja__trasera button{
    padding: 10px 40px;
    border: 2px solid #fff;
    font-size: 14px;
    background: transparent;
    font-weight: 600;
    cursor: pointer;
    color: white;
    outline: none;
    transition: all 300ms;
}

.caja__trasera button:hover{
    background: #fff;
    color: #46A2FD;
}

/*Formularios*/

.contenedor__login-register{
    display: flex;
    align-items: center;
    width: 100%;
    max-width: 380px;
    position: relative;
    top: -185px;
    left: 10px;

    /*La transicion va despues del codigo JS*/
    transition: left 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
}

.contenedor__login-register form{
    width: 100%;
    padding: 80px 20px;
    background: white;
    position: absolute;
    border-radius: 20px;
}

.contenedor__login-register form h2{
    font-size: 30px;
    text-align: center;
    margin-bottom: 20px;
    color: #46A2FD;
}

.contenedor__login-register form input{
    width: 100%;
    margin-top: 20px;
    padding: 10px;
    border: none;
    background: #F2F2F2;
    font-size: 16px;
    outline: none;
}

.contenedor__login-register form button{
    padding: 10px 40px;
    margin-top: 40px;
    border: none;
    font-size: 14px;
    background: #46A2FD;
    font-weight: 600;
    cursor: pointer;
    color: white;
    outline: none;
}




.formulario__login{
    opacity: 1;
    display: block;
}
.formulario__register{
    display: none;
}



@media screen and (max-width: 850px){

    main{
        margin-top: 50px;
    }

    .caja__trasera{
        max-width: 350px;
        height: 300px;
        flex-direction: column;
        margin: auto;
    }

    .caja__trasera div{
        margin: 0px;
        position: absolute;
    }


    /*Formularios*/

    .contenedor__login-register{
        top: -10px;
        left: -5px;
        margin: auto;
    }

    .contenedor__login-register form{
        position: relative;
    }
}



<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Aplicación de Facturación de Agua</title>
</head>
<body>
    <div class="container" id="login">
        <h1>Login - Super Administrador</h1>
        <form id="loginForm">
            <input type="password" placeholder="Contraseña" required>
            <button type="submit">Entrar</button>
        </form>
    </div>

    <div class="container" id="adminPanel" style="display: none;">
        <h1>Panel de Administrador</h1>
        <button id="searchSubscriber">Buscar Abonado</button>
        <button id="registerSubscriber">Registrar Abonado</button>
        <div id="subscriberSection" style="display: none;">
            <h2>Búsqueda de Abonado</h2>
            <input type="text" id="subscriberCode" placeholder="Código de Cliente Único">
            <button id="searchButton">Buscar</button>
            <div id="subscriberInfo"></div>
            <button id="payButton" style="display: none;">Pagar Tarifa</button>
        </div>
        <div id="registrationSection" style="display: none;">
            <h2>Registrar Nuevo Abonado</h2>
            <form id="registrationForm">
                <input type="text" placeholder="Nombre Completo" required>
                <input type="text" placeholder="Sector" required>
                <input type="text" placeholder="Teléfono" required>
                <input type="email" placeholder="Correo Electrónico" required>
                <input type="text" placeholder="Número de Lote" required>
                <button type="submit">Registrar</button>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>


<?php
session_start();
?>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Aplicación de Facturación de Agua</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container" id="login">
        <h1>Aplicación de Facturación de Agua</h1>
        <form id="loginForm" action="login.php" method="POST">
            <input type="nombre_usuario" name="nombre_usuario" placeholder="Nombre de Usuario" required>
            <input type="password" name="contrasena" placeholder="Contraseña" required>
            <button type="submit">Entrar</button>
        </form>   
       
        <a href="recuperar_contrasena.html">¿Olvidaste tu contraseña?</a>
        <a href="agregar_usuario.html">Registrar Nuevo Usuario</a>  
        
    </div>
</body>
</html>



<?php
session_start();
include 'conexion.php';

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $nombre_usuario = $_POST['nombre_usuario'];
    $contrasena = $_POST['contrasena'];

    $sql = "SELECT * FROM usuarios WHERE nombre_usuario = '$nombre_usuario'";
    $result = $conn->query($sql);

    if ($result->num_rows > 0) {
        $row = $result->fetch_assoc();
        if (password_verify($contrasena, $row['contrasena'])) {
            $_SESSION['nombre_usuario'] = $nombre_usuario;
            header("Location: opciones.php");
        } else {
            echo "Contraseña incorrecta.";
        }
    } else {
        echo "Usuario no encontrado.";
    }
}
?>


<?php
session_start();
session_destroy();
header("Location: index.php");
exit();
?>



<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Recuperar Contraseña</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="recovery-container">
        <h2>Recuperar Contraseña</h2>
        <form id="recoveryForm" action="recuperar_contrasena.php" method="POST">
            <input type="email" name="email" placeholder="Correo Electrónico" required>
            <button type="submit">Enviar Enlace de Recuperación</button>
        </form>
    </div>
</body>
</html>




<?php
include 'conexion.php';

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $email = $_POST['email'];

    $sql = "SELECT * FROM usuarios WHERE email = '$email'";
    $result = $conn->query($sql);

    if ($result->num_rows > 0) {
        // Generar un token único
        $token = bin2hex(random_bytes(50));
        $sql = "UPDATE usuarios SET token='$token' WHERE email='$email'";
        $conn->query($sql);

        // Enviar el enlace de recuperación por correo
        $to = $email;
        $subject = "Recuperación de Contraseña";
        $message = "Haz clic en el siguiente enlace para restablecer tu contraseña: http://tu_dominio.com/restablecer_contrasena.php?token=$token";
        $headers = "From: no-reply@tu_dominio.com";

        mail($to, $subject, $message, $headers);

        echo "Se ha enviado un enlace de recuperación a tu correo electrónico.";
    } else {
        echo "Correo electrónico no encontrado.";
    }
}
?>




<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Restablecer Contraseña</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="reset-container">
        <h2>Restablecer Contraseña</h2>
        <form id="resetForm" action="restablecer_contrasena.php" method="POST">
            <input type="hidden" name="token" value="<?php echo $_GET['token']; ?>" required>
            <input type="password" name="nueva_contrasena" placeholder="Nueva Contraseña" required>
            <button type="submit">Restablecer Contraseña</button>
        </form>
    </div>
</body>
</html>



document.getElementById('loginForm').onsubmit = function(e) {
    e.preventDefault();
    const password = e.target[0].value;
    if (password === 'superadmin') { // Cambia esto por una mejor autenticación
        document.getElementById('login').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
    } else {
        alert('Contraseña incorrecta');
    }
};

document.getElementById('searchSubscriber').onclick = function() {
    document.getElementById('subscriberSection').style.display = 'block';
    document.getElementById('registrationSection').style.display = 'none';
};

document.getElementById('registerSubscriber').onclick = function() {
    document.getElementById('registrationSection').style.display = 'block';
    document.getElementById('subscriberSection').style.display = 'none';
};

document.getElementById('searchButton').onclick = function() {
    const code = document.getElementById('subscriberCode').value;
    fetch('data.json')
        .then(response => response.json())
        .then(data => {
            const subscriber = data.find(sub => sub.codigo_cliente === code);
            if (subscriber) {
                document.getElementById('subscriberInfo').innerHTML = `
                    <p>Nombre: ${subscriber.nombre}</p>
                    <p>Sector: ${subscriber.sector}</p>
                    <p>Teléfono: ${subscriber.telefono}</p>
                    <p>Correo: ${subscriber.correo}</p>
                    <p>Número de Lote: ${subscriber.lote}</p>
                    <p>Fecha de Registro: ${subscriber.fecha_registro}</p>
                `;
                document.getElementById('payButton').style.display = 'block';
            } else {
                document.getElementById('subscriberInfo').innerHTML = '<p>Abonado no encontrado.</p>';
                document.getElementById('payButton').style.display = 'none';
            }
        });
};

document.getElementById('registrationForm').onsubmit = function(e) {
    e.preventDefault();
    // Aquí deberías implementar la lógica para guardar el nuevo abonado en tu base de datos JSON
    <?php
include 'conexion.php';

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $nombre_usuario = $_POST['nombre_usuario'];
    $sector = $_POST['sector'];
    $telefono = $_POST['telefono'];
    $email = $_POST['email'];
    $lote = $_POST['lote'];

    $sql = "INSERT INTO usuarios (nombre_usuario, sector, telefono,  email, lote) VALUES ('$nombre_usuario', '$sector', '$telefono' '$email', '$lote')";

    if ($conn->query($sql) === TRUE) {
        echo "Usuario agregado exitosamente.";
    } else {
        echo "Error al agregar el usuario: " . $conn->error;
    }
}
?>

    alert('Abonado registrado');
};



body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
    color: #333;
}

.container {
    max-width: 400px;
    margin: auto;
    padding: 20px;
    background-color: white;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 5px;
}

h1, h2 {
    text-align: center;
}

input {
    width: calc(100% - 20px);
    padding: 10px;
    margin: 10px 0;
}

button {
    width: 100%;
    padding: 10px;
    background-color: #007BFF;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

button:hover {
    background-color: #0056b3;
}






